<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>$FLIPPED â€” Flip Everything</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <style>
    :root{
      --bg:#0b0d10; --panel:#12151a; --panel-2:#0f1317; --grid:#1a1f26;
      --text:#e9eef6; --muted:#9aa7b3; --neon:#39ff88; --neon-soft:rgba(57,255,136,.18);
      --danger:#ff4d4d; --accent:#40d1ff; --gold:#d4af37;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(80vw 80vh at 50% -10%, rgba(57,255,136,.08), transparent 45%),
                  radial-gradient(60vw 60vh at -10% 120%, rgba(64,209,255,.06), transparent 40%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      overflow-x:hidden;
    }
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; opacity:.25;
      background:linear-gradient(transparent 31px, var(--grid) 32px),
                 linear-gradient(90deg, transparent 31px, var(--grid) 32px);
      background-size:32px 32px, 32px 32px;
      mask: linear-gradient(#000, transparent 65%);
      animation: drift 30s linear infinite;
    }
    @keyframes drift{from{transform:translateY(0)} to{transform:translateY(32px)}}

    .wrap{max-width:1200px; margin:0 auto; padding:24px 20px 96px}

    .topbar{display:flex; flex-direction:column; align-items:center; gap:18px; margin-bottom:20px}
    .btns{display:flex; gap:12px; justify-content:center}
    .btn{
      position:relative; isolation:isolate; border:1px solid var(--grid);
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      color:var(--text); padding:12px 18px; border-radius:999px; letter-spacing:.08em; text-transform:uppercase; font-weight:700;
      box-shadow:0 0 0 0 var(--neon-soft), inset 0 0 20px rgba(255,255,255,.02);
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease; text-decoration:none;
    }
    .btn:hover{ transform:translateY(-1px); border-color:var(--neon); box-shadow:0 0 24px -6px var(--neon-soft), inset 0 0 24px rgba(255,255,255,.04)}
    .btn:active{ transform:translateY(0)}
    .btn.x{ padding:12px 22px }
    .btn.buy{ background:linear-gradient(180deg, #0f1a14, #0c1511); border-color:rgba(57,255,136,.35)}
    .btn .shine{position:absolute; inset:-2px; border-radius:999px; background: conic-gradient(from 0deg, transparent 0 82%, rgba(57,255,136,.5) 84% 86%, transparent 88% 100%);
      filter:blur(8px); opacity:.0; transition:opacity .25s ease; z-index:-1; animation:spin 3s linear infinite}
    .btn:hover .shine{opacity:.6}
    @keyframes spin{to{transform:rotate(360deg)}}

    .kpis{display:grid; grid-template-columns: 1fr minmax(260px, 420px); gap:16px; align-items:stretch}
    .kpi, .latest{
      position:relative; background:linear-gradient(180deg, rgba(25,29,36,.9), rgba(16,19,24,.9));
      border:1px solid var(--grid); border-radius:16px; padding:18px 18px 16px; overflow:hidden;
    }
    .kpi::before, .latest::before{
      content:""; position:absolute; inset:0; border-radius:16px; pointer-events:none;
      background:radial-gradient(100% 60% at 0% 0%, rgba(57,255,136,.12), transparent 40%),
                 radial-gradient(80% 80% at 100% 0%, rgba(64,209,255,.08), transparent 40%);
    }
    .label{font-size:.78rem; letter-spacing:.12em; color:var(--muted); text-transform:uppercase}
    .value{font-size:2rem; font-weight:800; letter-spacing:.02em; margin-top:6px}
    .sub{color:var(--muted); font-size:.9rem}

    .latest .itemline{display:flex; gap:12px; align-items:center; margin-top:10px}
    .imgph{width:44px; height:44px; border-radius:10px; display:grid; place-items:center; font-size:24px; background:#121a15; border:1px solid rgba(57,255,136,.25); box-shadow: inset 0 0 18px rgba(57,255,136,.1)}
    .title{font-weight:700}
    .cash{margin-left:auto; font-weight:800; color:var(--neon)}

    .items{margin-top:18px; display:grid; grid-template-columns:1fr; gap:10px}
    @media(min-width:860px){ .items{ grid-template-columns: 1fr 1fr } }

    .card{position:relative; display:grid; grid-template-columns:64px 1fr auto; align-items:center; gap:14px; padding:12px; border-radius:14px; border:1px solid var(--grid);
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      transition:border-color .2s ease, transform .2s ease, box-shadow .2s ease; overflow:hidden}
    .card:hover{ border-color:var(--neon); transform:translateY(-1px); box-shadow:0 10px 30px -18px var(--neon-soft)}
    .card .imgph{width:56px; height:56px; font-size:26px}
    .card .desc{color:var(--muted); font-size:.95rem; margin-top:4px}
    .card .price{font-weight:900; font-size:1.1rem; color:var(--neon)}

    .card.flipped{ filter:saturate(.25) brightness(.75); border-color:#2a2f35; }
    .card.flipped::after{
      content:"FLIPPED"; position:absolute; right:12px; top:12px; padding:4px 8px; border:1px solid rgba(57,255,136,.35); color:var(--neon); border-radius:999px; font-weight:800; font-size:.72rem; letter-spacing:.1em; background:rgba(57,255,136,.08);
      animation: pop .35s ease; box-shadow:0 0 24px -6px var(--neon-soft);
    }
    @keyframes pop{ from{ transform:scale(.8); opacity:.0 } to{ transform:scale(1); opacity:1 } }

    .card .runner, .kpi .runner, .latest .runner{ position:absolute; height:2px; width:40%; background:linear-gradient(90deg, transparent, var(--neon), transparent); opacity:.7; filter:blur(.5px) }
    .card .runner{ top:-1px; left:0; animation:run 3.6s linear infinite }
    .kpi .runner{ bottom:-1px; right:0; animation:run 4.2s linear infinite reverse }
    .latest .runner{ top:-1px; right:0; animation:run 4.8s linear infinite }
    @keyframes run{ from{ transform:translateX(-60%) } to{ transform:translateX(160%) } }

    .scan{ position:absolute; inset:0; pointer-events:none; background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,.05) 10%, transparent 20%); transform:translateX(-120%); }
    .card.flipped .scan{ animation: sweep 900ms ease forwards }
    @keyframes sweep{ to{ transform:translateX(120%) } }

    .ticker{ position:sticky; top:0; z-index:5; margin-bottom:12px }
    .marquee{ overflow:hidden; border:1px solid var(--grid); border-radius:12px; background:linear-gradient(180deg, var(--panel), var(--panel-2)); }
    .track{ display:flex; gap:36px; padding:8px 12px; white-space:nowrap; animation: marquee 30s linear infinite }
    .pill{ font-size:.8rem; letter-spacing:.1em; color:var(--muted) }
    .dot{ width:6px; height:6px; background:var(--neon); border-radius:999px; display:inline-block; box-shadow:0 0 10px var(--neon) }
    @keyframes marquee{ from{ transform:translateX(0) } to{ transform:translateX(-50%) } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="ticker">
      <div class="marquee">
        <div class="track" id="tickerTrack"></div>
      </div>
    </div>

    <div class="topbar">
      <div class="btns">
        <a class="btn x" href="https://x.com/flippedcoinsol" id="xLink" aria-label="Go to X"><span class="shine"></span> X</a>
        <a class="btn buy" href="https://pump.fun/coin/" id="buyLink" aria-label="Buy $FLIPPED"><span class="shine"></span> BUY</a>
      </div>
    </div>

    <div class="kpis">
      <div class="kpi">
        <div class="runner"></div>
        <div class="label">$FLIPPED Market Cap</div>
        <div class="value" id="mcValue">$0</div>
        <div class="sub"><span class="dot"></span> systems up</div>
      </div>
      <div class="latest">
        <div class="runner"></div>
        <div class="label">Just Flipped</div>
        <div class="itemline" id="latestFlip">
          <div class="imgph">ğŸŒ€</div>
          <div>
            <div class="title">Nothingâ€¦ yet</div>
            <div class="sub">When MC â‰¥ item value, we flip it automatically.</div>
          </div>
          <div class="cash">$0</div>
        </div>
      </div>
    </div>

    <div class="items" id="items"></div>
  </div>

<script>
  /******************************
   * $FLIPPED â€” Core Page Script
   ******************************/

  // ---- API bridge to your server ----
  async function fetchMarketCap(){
    try{
      const resp = await fetch('/api/mc', { cache: 'no-store' });
      if(!resp.ok) return null;
      const data = await resp.json();
      return (typeof data.mc === 'number' && isFinite(data.mc)) ? data.mc : null;
    }catch{
      return null;
    }
  }

  const fmt = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:0 });

  // Items
  const items = [
    { e:"ğŸ›µ", t:"Vespa Primavera", d:"City scoot.", v:5000 },
    { e:"ğŸ¬", t:"Home Theater Setup", d:"Projector + audio.", v:7000 },
    { e:"ğŸï¸", t:"Kawasaki Ninja 400", d:"Entry sport bike.", v:8000 },
    { e:"ğŸš—", t:"Honda Civic (used)", d:"Reliable starter.", v:10000 },
    { e:"âœˆï¸", t:"Private Jet Hour", d:"One hour wheels-up.", v:12000 },
    { e:"ğŸ’", t:"Engagement Ring 1.5ct", d:"White gold set.", v:15000 },
    { e:"ğŸš™", t:"Toyota Corolla (used)", d:"Bulletproof commuter.", v:20000 },
    { e:"ğŸ› ï¸", t:"Kitchen Renovation", d:"Mid-range remodel.", v:25000 },
    { e:"âš¡", t:"Tesla Model 3 (used)", d:"EV daily driver.", v:30000 },
    { e:"ğŸš˜", t:"BMW 3 Series (CPO)", d:"Entry luxury.", v:40000 },
    { e:"ğŸ¡", t:"Down Payment (smaller city)", d:"Keys getting closer.", v:45000 },
    { e:"âŒš", t:"Rolex Day-Date (pre-owned)", d:"President vibes.", v:50000 },
    { e:"ğŸš™", t:"Mercedes GLC", d:"Daily luxury SUV.", v:60000 },
    { e:"ğŸš™", t:"Range Rover Sport (used)", d:"High-spec used.", v:70000 },
    { e:"âš¡", t:"Tesla Model X (used)", d:"Falcon doors.", v:80000 },
    { e:"ğŸ¤£", t:"All non-migrated coins", d:"Workhorse.", v:88600 },
    { e:"ğŸï¸", t:"Porsche 911 (high-mile)", d:"Driverâ€™s car.", v:90000 },
    { e:"ğŸ“£", t:"Times Sq Billboard (1 day)", d:"Mass reach, 24h.", v:100000 },
    { e:"ğŸª™", t:"1 BTC (ATH ~$120k)", d:"Single coin flex.", v:120000 },
    { e:"ğŸ ", t:"Down Payment (major city)", d:"From charts to keys.", v:150000 },
    { e:"ğŸï¸", t:"Ferrari California (used)", d:"Open-top V8.", v:180000 },
    { e:"ğŸ‚", t:"Lamborghini Gallardo (used)", d:"Early 2000s icon.", v:200000 },
    { e:"ğŸ¥", t:"Indie Film Budget", d:"Script to screen.", v:250000 },
    { e:"ğŸ›¥ï¸", t:"40 ft Yacht (used)", d:"Weekend cruiser.", v:300000 },
    { e:"ğŸ½ï¸", t:"Restaurant Build-out", d:"FOH + BOH.", v:350000 },
    { e:"ğŸ¡", t:"Starter Home", d:"JPEGs â†’ address.", v:400000 },
    { e:"ğŸ§‘â€ğŸš€", t:"Suborbital Flight (pair)", d:"Edge of space.", v:450000 },
    { e:"ğŸ›°ï¸", t:"CubeSat Launch Slot", d:"Into orbit.", v:500000 },
    { e:"ğŸšï¸", t:"Luxury Home Renovation", d:"Gut + rebuild.", v:600000 },
    { e:"ğŸï¸", t:"Rare Classic Car", d:"Collector spec.", v:700000 },
    { e:"ğŸ¢", t:"Theme Park Day Buyout", d:"All rides, all day.", v:800000 },
    { e:"ğŸ’¼", t:"Seed Round Check", d:"Angel mode.", v:900000 },
    { e:"ğŸ¦", t:"$1M in T-Bills", d:"Short-term yield.", v:1000000 },
    { e:"ğŸ¢", t:"Luxury Condo", d:"Skyline views.", v:1200000 },
    { e:"ğŸ¢", t:"Small Apartment Building", d:"Cashflow IRL.", v:1500000 },
    { e:"ğŸ¤", t:"Arena World Tour Leg", d:"Production + crew.", v:1800000 },
    { e:"ğŸš€", t:"Rocket Launch Sponsorship", d:"Co-brand a mission.", v:2000000 },
    { e:"ğŸ¨", t:"Boutique Hotel Purchase", d:"Keys + lobby bar.", v:2500000 },
    { e:"ğŸï¸", t:"Private Island (purchase)", d:"Sand, not FUD.", v:3000000 },
    { e:"ğŸ¬", t:"Feature Film Production", d:"Studio-level set.", v:4000000 },
    { e:"ğŸ™ï¸", t:"Penthouse (major city)", d:"Views > bears.", v:5000000 },
    { e:"âœˆï¸", t:"Gulfstream G200 (used)", d:"Serious sky flex.", v:6000000 },
    { e:"ğŸˆ", t:"Super Bowl 30s Ad", d:"Peak normie reach.", v:7000000 },
    { e:"ğŸ–¼ï¸", t:"Blue-chip Art Masterpiece", d:"Auction hammer.", v:8000000 },
    { e:"ğŸ¢", t:"National Brand Buyout (small)", d:"Roll-up play.", v:9000000 },
    { e:"ğŸ¥‡", t:"$10M in Gold Bullion", d:"Heavy and shiny.", v:10000000 },
    { e:"ğŸ¥", t:"Hospital Wing Naming", d:"Endowment gift.", v:12000000 },
    { e:"ğŸ®", t:"AAA Game Launch Budget", d:"Dev + marketing.", v:15000000 },
    { e:"ğŸ¥", t:"A-List Film Budget", d:"Stars + VFX.", v:20000000 },
    { e:"ğŸï¸", t:"Private Island Estate", d:"Compound build-out.", v:25000000 },
    { e:"ğŸ“º", t:"Regional Sports Media Rights", d:"Seasons of eyeballs.", v:30000000 },
    { e:"ğŸ¬", t:"Studio Backlot Purchase", d:"Stages + lots.", v:40000000 },
    { e:"ğŸ¦„", t:"Unicorn Series A", d:"Fuel the rocket.", v:50000000 },
    { e:"ğŸï¸", t:"F1 Title Sponsorship (season)", d:"Global brand laps.", v:60000000 },
    { e:"ğŸ–¼ï¸", t:"Blue-chip Painting (record)", d:"Museum grade.", v:70000000 },
    { e:"ğŸ“£", t:"Nationwide Ad Blitz (quarter)", d:"TV + digital.", v:80000000 },
    { e:"ğŸ­", t:"Data Center Build (large)", d:"MWs of compute.", v:90000000 },
    { e:"ğŸ’»", t:"Tech Company Acquisition (small)", d:"Buy vs build.", v:100000000 },
    { e:"ğŸŸï¸", t:"Arena Naming Rights (long-term)", d:"Prime venue.", v:150000000 },
    { e:"ğŸ“¡", t:"Regional Telco Acquisition", d:"Fiber & spectrum.", v:200000000 },
    { e:"ğŸ—ï¸", t:"Skyscraper Core & Shell", d:"Touch the clouds.", v:250000000 },
    { e:"ğŸ¥", t:"Studio Backlot Expansion", d:"New soundstages.", v:300000000 },
    { e:"ğŸ›°ï¸", t:"Satellite Constellation Batch", d:"Cover the globe.", v:400000000 },
    { e:"ğŸ§", t:"Global Music Catalog Deal", d:"All the hits.", v:500000000 },
    { e:"ğŸ®", t:"Game Publisher Acquisition", d:"IP library.", v:600000000 },
    { e:"ğŸ†", t:"National Sports Rights (cycle)", d:"Prime league.", v:700000000 },
    { e:"ğŸ’", t:"League Expansion Fee", d:"New franchise slot.", v:750000000 },
    { e:"ğŸš€", t:"Spaceport Buildout (Phase 1)", d:"Pads + range.", v:800000000 },
    { e:"ğŸ’¨", t:"Fartcoin", d:"Light work. It's just fartcoin", v:820000000 },
    { e:"ğŸ¦", t:"Regional Bank Rescue", d:"Balance sheet triage.", v:900000000 },
    { e:"ğŸ¦„", t:"Decacorn Threshold", d:"$1B valuation.", v:1000000000 },
    { e:"ğŸ¬", t:"Studio Slate (multi-film)", d:"Back-to-back releases.", v:1500000000 },
    { e:"âš½", t:"Premier League Club (mid)", d:"Matchday + rights.", v:2000000000 },
    { e:"ğŸ’", t:"NHL Franchise", d:"Original-six dreams.", v:3000000000 },
    { e:"ğŸ€", t:"NBA Franchise", d:"Playoff engine.", v:5000000000 },
    { e:"ğŸ¢", t:"Fortune-500 Brand Acquisition", d:"Household name.", v:10000000000 }
  ];

  // Build ticker phrases
  const track = document.getElementById('tickerTrack');
  const tickPhrases = Array(8).fill("ca: ...pump â€¢");
  for(let i=0;i<2;i++) tickPhrases.forEach(p=>{
    const span=document.createElement('span'); span.className='pill'; span.textContent=p; track.appendChild(span);
  });

  // Build cards
  const itemsRoot = document.getElementById('items');
  items.sort((a,b)=>a.v-b.v);
  items.forEach((it, idx)=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.value = it.v;
    card.dataset.index = idx;
    card.innerHTML = `
      <div class="imgph">${it.e}</div>
      <div>
        <div class="title">${it.t}</div>
        <div class="desc">${it.d}</div>
      </div>
      <div class="price">${fmt.format(it.v)}</div>
      <div class="runner"></div>
      <div class="scan"></div>
    `;
    itemsRoot.appendChild(card);
  });

  /* === Permanent flipped state (persist across sessions) + migration === */
  const FLIPPED_KEY = 'flip.flipped.v12';

  function loadFlipped() {
    const raw = JSON.parse(localStorage.getItem(FLIPPED_KEY) || '[]');
    const idxs = [];
    for (const x of raw) {
      if (typeof x !== 'number') continue;
      if (x >= 0 && x < items.length) idxs.push(x);
      else {
        const i = items.findIndex(it => it.v === x);
        if (i !== -1) idxs.push(i);
      }
    }
    return new Set(idxs);
  }
  const flippedSet = loadFlipped();

  function saveFlipped(){ localStorage.setItem(FLIPPED_KEY, JSON.stringify([...flippedSet])); }
  function applyFlippedFromStorage(){
    document.querySelectorAll('.card').forEach(card=>{
      const idx = Number(card.dataset.index);
      if (flippedSet.has(idx)) card.classList.add('flipped');
    });
  }

  function computeLatestFromState(){
    let best = null, bestV = -1, bestIdx = -1;
    document.querySelectorAll('.card.flipped').forEach(card=>{
      const v = Number(card.dataset.value);
      const idx = Number(card.dataset.index);
      if (v > bestV) { bestV = v; bestIdx = idx; }
    });
    if (bestIdx >= 0) best = items[bestIdx];
    return best;
  }

  applyFlippedFromStorage();

  // State + logic
  let marketCap = 0;
  let latest = null;
  const mcValueEl = document.getElementById('mcValue');
  const latestFlipEl = document.getElementById('latestFlip');

  // initialize "latest" on load based on storage
  const initLatest = computeLatestFromState();
  if (initLatest) { latest = initLatest; updateLatest(initLatest); }

  function setMarketCap(val){
    const next = Math.max(0, Number(val)||0);
    if (next === marketCap) { return; } // no DOM churn if same
    marketCap = next;
    mcValueEl.textContent = fmt.format(marketCap);
    const cards = [...document.querySelectorAll('.card')];
    let flippedSomething = false;
    let localLatest = null;

    for (const card of cards){
      const v = Number(card.dataset.value);
      const idx = Number(card.dataset.index);
      if(v <= marketCap && !card.classList.contains('flipped')){
        card.classList.add('flipped');
        flippedSet.add(idx);
        flippedSomething = true;
        localLatest = items[idx];
      }
    }
    if (flippedSomething) saveFlipped();

    if(flippedSomething && localLatest){
      latest = localLatest;
      updateLatest(localLatest);
    } else {
      const best = computeLatestFromState();
      if (best && (!latest || best.v !== latest.v)) {
        latest = best;
        updateLatest(best);
      }
    }
  }

  function updateLatest(it){
    latestFlipEl.innerHTML = `
      <div class="imgph">${it.e}</div>
      <div>
        <div class="title">${it.t}</div>
        <div class="sub">We just flipped this. Next target loadingâ€¦</div>
      </div>
      <div class="cash">${fmt.format(it.v)}</div>
    `;
    latestFlipEl.animate(
      [{ transform:'scale(1)', boxShadow:'none' },
       { transform:'scale(1.02)', boxShadow:'0 0 40px -10px var(--neon-soft)' },
       { transform:'scale(1)' }],
      { duration:600, easing:'ease' }
    );
  }

  // --- Fixed 2s polling via your API (/api/mc) with overlap protection ---
  let inflightController = null;

  async function pollOnce() {
    // abort previous if still running so we don't pile up
    if (inflightController) inflightController.abort();
    inflightController = new AbortController();

    try {
      const resp = await fetch('/api/mc', {
        cache: 'no-store',
        signal: inflightController.signal,
        keepalive: true
      });
      if (!resp.ok) return;
      const data = await resp.json();
      if (data && typeof data.mc === 'number' && data.mc > 0) {
        setMarketCap(data.mc);
      }
    } catch (e) {
      // swallow; keep last known MC
    } finally {
      inflightController = null;
    }
  }

  // Initial fetch then steady 2s cadence (simple, reliable)
  (async ()=>{
    try{
      const live = await fetchMarketCap();
      if(typeof live === 'number' && live > 0){
        setMarketCap(live);
      }
    }catch{}
    setInterval(pollOnce, 2000);
  })();
</script>

</body>
</html>
















